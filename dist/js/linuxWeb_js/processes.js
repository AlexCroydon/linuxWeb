processes={currentlySelectedProcess:null,pid:{},getPidObject:function(){let e={};return Object.values(this.pid).forEach(t=>{"object"==typeof e&&(e[t.id]=t)}),e!={}&&Object.values(e)},getNewPid:function(){return 0==Object.entries(this.pid).length?0:Number(Object.keys(this.pid).sort().slice(-1))+1},getNumberPid:function(e){return Number(e.split("pid")[1])},getFirstPidFormAppName:function(e){let t=this.getPidObject();for(let i=0;i<t.length;i++)if(t[i].appName==e)return t[i]},getRunningInstanceAmount:function(e){let t=0,i=this.getPidObject();for(let n=0;n<i.length;n++)i[n].appName==e&&t++;return t},bringToTop:function(e,t=null){if(null!=t&&t.target.tagName.endsWith("ICON")&&"APP_HEADER"==t.target.parentElement.parentElement.tagName)return!1;const i=this.getNumberPid(e.id);if("function"==typeof this.pid[i].onFocus&&setTimeout(()=>{this.pid[i].onFocus()},1),this.currentlySelectedProcess==this.pid[i])return!1;1==this.pid[i].minimized&&(e.style.transform="",e.style.opacity="",e.style.display="",this.pid[i].minimized=!1),appsContainer.insertAdjacentElement("beforeend",e),this.makeProcessResizable("#"+e.id),null!=this.currentlySelectedProcess&&this.currentlySelectedProcess.getProcessBarElement().classList.remove("selected"),this.pid[i].getProcessBarElement().classList.add("selected"),this.currentlySelectedProcess=this.pid[i]},processSchema:{title:"Untitled App",titleColor:"inherit",bodyColor:"inherit",textColor:"inherit",headerColor:"var(--main-color);",headerBottomColor:"inherit",bodyBorderSize:"inherit",padding:"inherit",additionalBodyCss:"",opacity:1,HTML:String(),height:300,width:500,minHeight:150,minWidth:150,bodyBorder:Boolean(),fullHeight:!1,fullWidth:!1},maximize:function(e){let t=this.getNumberPid(e),i=document.querySelector("#"+e);this.bringToTop(i),1==this.pid[t].maximized?(i.style.transition="all 0.5s ease-in-out",i.style.top=this.pid[t].positionBeforeMaximize.y,i.style.left=this.pid[t].positionBeforeMaximize.x,i.style.height=this.pid[t].sizeBeforeMaximize.height,i.style.width=this.pid[t].sizeBeforeMaximize.width,i.querySelector("app_resize").style.display="",this.pid[t].maximized=!1):(this.pid[t].positionBeforeMaximize={x:i.style.left,y:i.style.top},this.pid[t].sizeBeforeMaximize={width:i.clientWidth+"px",height:i.clientHeight+"px"},i.style.transition="all 0.5s ease-in-out",i.style.top="27px",i.style.left="0px",i.style.height=window.innerHeight-55+"px",i.style.width=window.innerWidth+"px",i.querySelector("app_resize").style.display="none",this.pid[t].maximized=!0),setTimeout(()=>{i.style.transition=""},500)},minimize:function(e){let t=this.getNumberPid(e),i=document.querySelector("#"+e);this.bringToTop(i),i.style.transform="scale(0.5)",i.style.opacity="0",this.pid[t].minimized=!0,this.currentlySelectedProcess=null,this.pid[t].getProcessBarElement().classList.remove("selected"),setTimeout(()=>{i.style.display="none"},500)},remove:function(e){let t=this.getNumberPid(e);document.querySelector("#"+e).remove(),this.pid[t].getProcessBarElement().remove(),delete this.pid[t],this.currentlySelectedProcess=null},create:function(e,t={x:"default",y:"default"}){if(null==apps[e])return console.error(`Not Found: App '${e}' does not exist`),!1;if(apps[e].createData.onlyOneInstanceAllowed&&this.getRunningInstanceAmount(e)>0){return this.bringToTop(this.getFirstPidFormAppName(e).getProcessElement()),!1}let i=processes.getNewPid(),n="pid"+i,s={};Object.assign(s,this.processSchema),Object.assign(s,apps[e].createData),s.height<s.minHeight&&(s.height=s.minHeight),s.width<s.minWidth&&(s.width=s.minWidth),"default"==t.y&&(t.y=window.innerHeight/2-s.height/2),"default"==t.x&&(t.x=window.innerWidth/2-s.width/2);let o=`\n\t\t\tmin-height:${s.minHeight}px;\n\t\t\tmin-width:${s.minWidth}px;\n\t\t\tz-Index: 4;\n\t\t`,r=`\n\t\t\tbackground-color:${s.bodyColor};\n\t\t\tcolor:${s.textColor};\n\t\t\tmargin:${s.bodyBorder&&s.bodyBorderSize||"0px"};\n\t\t\theight:${s.fullHeight?"100%":"auto"};\n\t\t\twidth:${s.fullWidth?"100%":"auto"};\n\t\t\topacity: ${s.opacity};\n\t\t\tpadding: ${s.padding};\n\t\t\t${s.additionalBodyCss}\n\t\t`,l=`\n\t\t\tcolor: ${s.titleColor};\n\t\t\tbackground-color:${s.headerColor};\n\t\t\tborder-bottom: 1px solid ${s.headerBottomColor};\n\t\t`;return appHTML=`\n\t\t\t<app_container onmousedown="processes.bringToTop(this,event)" id='${n}' style = "top: ${t.y}px;left: ${t.x}px;${o}" >\n\t\t\t\t<app_header style="${l}opacity:1;" onmousedown="processes.processMouseDownHandler(event, '${n}')" >\n\t\t\t\t\t<app_title onmousedown="processes.processMouseDownHandler(event, '${n}')">${s.title}</app_title>\n\t\t\t\t\t<app_minimize onclick="processes.minimize('${n}')"><minus_icon></minus_icon></app_minimize>\n\t\t\t\t\t<app_maximize onclick="processes.maximize('${n}')"><square_icon></square_icon></app_maximize>\n\t\t\t\t\t<app_exit onclick="processes.remove('${n}')"><x_icon></x_icon></app_exit>\n\t\t\t\t</app_header>\n\t\t\t\t<app_body style="${r}">\n\t\t\t\t\t${s.getHTML()}\n\t\t\t\t</app_body>\n\t\t\t\t<app_resize>\n\t\t\t\t\t<resize_point class='bottom-right'></resize_point>\n\t\t\t\t\t<resize_point class='bottom-left'></resize_point>\n\t\t\t\t\t<resize_point class='top-right'></resize_point>\n\t\t\t\t\t<resize_point class='top-left'></resize_point>\n\n\t\t\t\t\t<resize_point class='top'></resize_point>\n\t\t\t\t\t<resize_point class='left'></resize_point>\n\t\t\t\t\t<resize_point class='right'></resize_point>\n\t\t\t\t\t<resize_point class='bottom'></resize_point>\n\t\t\t\t\t</app_resize>\n\n\t\t\t\t</app_container>\n\t\t\t\n\t\t`,appsContainer.insertAdjacentHTML("beforeend",appHTML),(async()=>{await delay(5e3),appList.innerHTML+=`<process onclick="processes.bringToTop(document.querySelector('#${n}'))" id='appListPID${i}'>${s.title}</process>`,processes.pid[i]={},Object.assign(processes.pid[i],s.methods),Object.assign(processes.pid[i],{id:i,elementId:n,appName:e,minimized:!1,maximized:!1,positionBeforeMaximize:{x:t.x,y:t.y},sizeBeforeMaximize:{width:s.width,height:s.height},originalOffsetY:0,originalOffsetX:0,getProcessElement:function(){return document.querySelector("#"+this.elementId)},getProcessElementBody:function(){return document.querySelector(`#${this.elementId}>app_body`)},getProcessElementHeader:function(){return document.querySelector(`#${this.elementId} app_header`)},getProcessBarElement:function(){return document.querySelector("#appListPID"+this.id)}}),this.makeProcessResizable("#"+processes.pid[i].elementId),this.bringToTop(processes.pid[i].getProcessElement()),null!=apps[e].onStart&&apps[e].onStart(processes.pid[i]),s={}})(),!0},processMouseDownHandler:function(e,t){pid=this.getNumberPid(t);let i=this.pid[pid];if("APP_HEADER"!=e.target.tagName&&"APP_TITLE"!=e.target.tagName||this.pid[pid].maximized)return!1;i.originalOffsetY=e.layerY,i.originalOffsetX=e.layerX,document.body.setAttribute("onmousemove",`processes.processMouseMoveHandler(event,processes.pid['${pid}'])`),i.getProcessElementHeader().onmouseup=()=>{document.body.setAttribute("onmousemove",null),i.getProcessElementHeader().setAttribute("onmouseup",null)}},processMouseMoveHandler:function(e,t){var i=e.clientY-t.originalOffsetY,n=e.clientX-t.originalOffsetX;t.getProcessElement().style.top=i+"px",t.getProcessElement().style.left=n+"px"},makeProcessResizable:function(e){const t=document.querySelector(e),i=document.querySelectorAll(e+" resize_point"),n=t.style.minWidth.replace("px","")||150,s=t.style.minHeight.replace("px","")||150;let o=0,r=0,l=0,p=0,d=0,a=0;i.forEach(e=>{function i(i){const c=e.classList.toString();if(c.includes("top")){const e=r-(i.pageY-a);e>s&&e<=window.innerHeight&&(t.style.height=e+"px",t.style.top=p+(i.pageY-a)+"px")}else if(c.includes("bottom")){const e=r+(i.pageY-a);e>s&&e<=window.innerHeight&&(t.style.height=e+"px")}if(c.includes("left")){const e=o-(i.pageX-d);e>n&&e<=window.innerWidth&&(t.style.width=e+"px",t.style.left=l+(i.pageX-d)+"px")}else if(c.includes("right")){const e=o+(i.pageX-d);e>n&&e<=window.innerWidth&&(t.style.width=e+"px")}height>=window.innerHeight&&(t.style.height=window.innerHeight),width>=window.innerWidth&&(t.style.width=window.innerWidth)}function c(){document.body.setAttribute("onmousemove",null),window.removeEventListener("mousemove",i)}e.addEventListener("mousedown",(function(e){e.preventDefault(),o=parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),r=parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px","")),l=t.getBoundingClientRect().left,p=t.getBoundingClientRect().top,d=e.pageX,a=e.pageY,window.addEventListener("mousemove",i),window.addEventListener("mouseup",c)}))})}};