processes={currentlySelectedProcess:null,pid:{},getPidObject:function(){let e={};return Object.values(this.pid).forEach(t=>{"object"==typeof e&&(e[t.id]=t)}),e!={}&&Object.values(e)},getNewPid:function(){return 0==Object.entries(this.pid).length?0:Number(Object.keys(this.pid).sort().slice(-1))+1},getNumberPid:function(e){return Number(e.split("pid")[1])},getFirstPidFormAppName:function(e){let t=this.getPidObject();for(let i=0;i<t.length;i++)if(t[i].appName==e)return t[i]},getRunningInstanceAmount:function(e){let t=0,i=this.getPidObject();for(let o=0;o<i.length;o++)i[o].appName==e&&t++;return t},bringToTop:function(e,t=null){if(null!=t&&t.target.tagName.endsWith("ICON")&&"APP_HEADER"==t.target.parentElement.parentElement.tagName)return!1;const i=this.getNumberPid(e.id);if("function"==typeof this.pid[i].onFocus&&setTimeout(()=>{this.pid[i].onFocus()},1),this.currentlySelectedProcess==this.pid[i])return!1;1==this.pid[i].minimized&&(e.style.transform="",e.style.opacity="",e.style.display="",this.pid[i].minimized=!1),appsContainer.insertAdjacentElement("beforeend",e),this.makeProcessResizable("#"+e.id),null!=this.currentlySelectedProcess&&this.currentlySelectedProcess.getProcessBarElement().classList.remove("selected"),this.pid[i].getProcessBarElement().classList.add("selected"),this.currentlySelectedProcess=this.pid[i]},processSchema:{title:"Untitled App",titleColor:"",bodyColor:"",textColor:"",headerColor:"",headerBorderBottomColor:"transparent",bodyBorderSize:"",padding:"",additionalBodyCss:"",opacity:1,HTML:String(),height:300,width:500,minHeight:150,minWidth:150,bodyBorder:Boolean(),fullHeight:!1,fullWidth:!1},createWindowSizeProjection:function(e,t){let i=e.getProcessElement(),o=topBar.offsetHeight,s=0,n=document.body.offsetWidth,r=window.innerHeight-(appList.offsetHeight-topBar.offsetHeight);switch(t){case"maximum":break;case"left-half":n=document.body.offsetWidth/2;break;case"right-half":n=document.body.offsetWidth/2,s=document.body.offsetWidth/2}if(void 0!==document.querySelector(t+"-wsp")){let l=`\n            top:${o}px;\n            left:${s}px;\n            width:${n}px;\n            height:${r}px;\n        `;if(e.projectedSize={top:o,left:s,width:n,height:r},system.global.elementExists(document.querySelector("window_size_projection"))){document.querySelector("window_size_projection").style.cssText=l,i.insertAdjacentElement("beforebegin",document.querySelector("window_size_projection"))}else this.hideWindowSizeProjection(e),windowSizeProjectionHTML=`<window_size_projection id='#${t}-wsp' style='${l}' ></window_size_projection>`,i.insertAdjacentHTML("beforebegin",windowSizeProjectionHTML)}},scaleToProjectedSize:function(e){system.global.elementExists(e.projectedSize)&&!system.global.isObjectEmpty(e.projectedSize)&&this.maximize(e.elementId,e.projectedSize),this.hideWindowSizeProjection(e)},hideWindowSizeProjection:function(e,t=!1){if(t)return e.projectedSize={},el.style.opacity=0,setTimeout(()=>{el.style="opacity:0"},100),!0;if(el=document.querySelector("window_size_projection"),system.global.elementExists(el)){if("opacity:0;"==el.style.cssText)return!1;el.id="",e.projectedSize={},el.style.opacity=0}},maximize:function(e,t={}){let i=this.getNumberPid(e),o=document.querySelector("#"+e);this.bringToTop(o),1==this.pid[i].maximized?(console.log(this.pid[i].positionBeforeMaximize.y,this.pid[i].positionBeforeMaximize.x),o.style.transition="all 0.3s ease-in-out",o.style.top=this.pid[i].positionBeforeMaximize.y,o.style.left=this.pid[i].positionBeforeMaximize.x,o.style.height=this.pid[i].sizeBeforeMaximize.height,o.style.width=this.pid[i].sizeBeforeMaximize.width,o.querySelector("app_resize").style.display="",this.pid[i].maximized=!1):(this.pid[i].positionBeforeMaximize={x:o.style.left,y:o.style.top},this.pid[i].sizeBeforeMaximize={width:o.clientWidth+"px",height:o.clientHeight+"px"},o.style.transition="all 0.3s ease-in-out",system.global.isObjectEmpty(t)?(o.style.top=topBar.offsetHeight+"px",o.style.left="0px",o.style.height=window.innerHeight-(appList.offsetHeight-topBar.offsetHeight)+"px",o.style.width=window.innerWidth+"px"):(o.style.top=t.top+"px",o.style.left=t.left+"px",o.style.height=t.height+"px",o.style.width=t.width+"px"),o.querySelector("app_resize").style.display="none",this.pid[i].maximized=!0),setTimeout(()=>{o.style.transition=""},500)},minimize:function(e){let t=this.getNumberPid(e),i=document.querySelector("#"+e);this.bringToTop(i),i.style.transform="scale(0.5)",i.style.opacity="0",this.pid[t].minimized=!0,this.currentlySelectedProcess=null,this.pid[t].getProcessBarElement().classList.remove("selected"),setTimeout(()=>{i.style.display="none"},500)},remove:function(e){let t=this.getNumberPid(e);document.querySelector("#"+e).remove(),this.pid[t].getProcessBarElement().remove(),delete this.pid[t],this.currentlySelectedProcess=null},create:function(e,t={x:"default",y:"default"}){if(null==apps[e])return console.error(`Not Found: App '${e}' does not exist`),!1;if(apps[e].createData.onlyOneInstanceAllowed&&this.getRunningInstanceAmount(e)>0){return this.bringToTop(this.getFirstPidFormAppName(e).getProcessElement()),!1}let i=processes.getNewPid(),o="pid"+i,s={};Object.assign(s,this.processSchema),Object.assign(s,apps[e].createData),s.height<s.minHeight&&(s.height=s.minHeight),s.width<s.minWidth&&(s.width=s.minWidth),"default"==t.y&&(t.y=window.innerHeight/2-s.height/2),"default"==t.x&&(t.x=window.innerWidth/2-s.width/2);let n=`\n\t\t\tmin-height:${s.minHeight}px;\n\t\t\tmin-width:${s.minWidth}px;\n\t\t\tz-Index: 4;\n\t\t`,r=`\n\t\t\tbackground-color:${s.bodyColor};\n\t\t\tcolor:${s.textColor};\n\t\t\tmargin:${s.bodyBorder&&s.bodyBorderSize||"0px"};\n\t\t\theight:${s.fullHeight?"100%":"auto"};\n\t\t\twidth:${s.fullWidth?"100%":"auto"};\n\t\t\topacity: ${s.opacity};\n\t\t\tpadding: ${s.padding};\n\t\t\t${s.additionalBodyCss}\n\t\t`,l=`\n\t\t\tcolor: ${s.titleColor};\n\t\t\tbackground-color:${s.headerColor};\n\t\t\tborder-bottom: 1px solid ${s.headerBorderBottomColor};\n\t\t`;return appHTML=`\n\t\t\t<app_container onmousedown="processes.bringToTop(this,event)" id='${o}' style = "top: ${t.y}px;left: ${t.x}px;${n}" >\n\t\t\t\t<app_header style="${l}opacity:1;" onmousedown="processes.processMouseDownHandler(event, '${o}')" >\n\t\t\t\t\t<app_title onmousedown="processes.processMouseDownHandler(event, '${o}')">${s.title}</app_title>\n\t\t\t\t\t<app_minimize onclick="processes.minimize('${o}')"><minus_icon></minus_icon></app_minimize>\n\t\t\t\t\t<app_maximize onclick="processes.maximize('${o}')"><square_icon></square_icon></app_maximize>\n\t\t\t\t\t<app_exit onclick="processes.remove('${o}')"><x_icon></x_icon></app_exit>\n\t\t\t\t</app_header>\n\t\t\t\t<app_body style="${r}">\n\t\t\t\t\t${s.getHTML()}\n\t\t\t\t</app_body>\n\t\t\t\t<app_resize>\n\t\t\t\t\t<resize_point class='bottom-right'></resize_point>\n\t\t\t\t\t<resize_point class='bottom-left'></resize_point>\n\t\t\t\t\t<resize_point class='top-right'></resize_point>\n\t\t\t\t\t<resize_point class='top-left'></resize_point>\n\n\t\t\t\t\t<resize_point class='top'></resize_point>\n\t\t\t\t\t<resize_point class='left'></resize_point>\n\t\t\t\t\t<resize_point class='right'></resize_point>\n\t\t\t\t\t<resize_point class='bottom'></resize_point>\n\t\t\t\t\t</app_resize>\n\n\t\t\t\t</app_container>\n\t\t\t\n\t\t`,appsContainer.insertAdjacentHTML("beforeend",appHTML),appList.innerHTML+=`<process onclick="processes.bringToTop(document.querySelector('#${o}'))" id='appListPID${i}'>${s.title}</process>`,processes.pid[i]={},Object.assign(processes.pid[i],s.methods),Object.assign(processes.pid[i],{id:i,elementId:o,appName:e,minimized:!1,maximized:!1,positionBeforeMaximize:{x:t.x,y:t.y},sizeBeforeMaximize:{width:s.width,height:s.height},originalOffsetY:0,originalOffsetX:0,getProcessElement:function(){return document.querySelector("#"+this.elementId)},getProcessElementBody:function(){return document.querySelector(`#${this.elementId}>app_body`)},getProcessElementHeader:function(){return document.querySelector(`#${this.elementId} app_header`)},getProcessBarElement:function(){return document.querySelector("#appListPID"+this.id)}}),this.makeProcessResizable("#"+processes.pid[i].elementId),this.bringToTop(processes.pid[i].getProcessElement()),null!=apps[e].onStart&&apps[e].onStart(processes.pid[i]),s={},!0},processMouseDownHandler:function(e,t,i=!1){pid=this.getNumberPid(t);let o=this.pid[pid];if("APP_HEADER"!=e.target.tagName&&"APP_TITLE"!=e.target.tagName&&!i)return!1;if(o.maximized){let t=e.clientY,i=e.clientX;return document.body.onmousemove=e=>{if(Math.abs(t-e.clientY)+Math.abs(i-e.clientX)>40){o.maximized=!0;let t=o.getProcessElement();t.style.top=e.layerY,document.body.setAttribute("onmousemove",null);let i=e.layerX/t.offsetWidth*o.sizeBeforeMaximize.width.replace("px",""),s=e.clientY,n=e.clientX-i;o.originalOffsetY=e.layerY,o.originalOffsetX=i,o.positionBeforeMaximize.x=n+"px",o.positionBeforeMaximize.y=s+"px",t.style.height=o.sizeBeforeMaximize.height,t.style.width=o.sizeBeforeMaximize.width,t.style.top=s+"px",t.style.left=n+"px",o.maximized=!1,t.querySelector("app_resize").style.display="",processes.initiateProcessMouseMoveHandler(o)}},!1}o.originalOffsetY=e.layerY,o.originalOffsetX=e.layerX,console.log("click",o.originalOffsetY,o.originalOffsetX),this.initiateProcessMouseMoveHandler(o)},initiateProcessMouseMoveHandler:function(e){document.body.setAttribute("onmousemove",`processes.processMouseMoveHandler(event,processes.pid['${pid}'])`),document.body.onmouseup=()=>{document.body.setAttribute("onmousemove",null),e.getProcessElementHeader().setAttribute("onmouseup",null),this.scaleToProjectedSize(e),this.hideWindowSizeProjection(e,!0)}},processMouseMoveHandler:function(e,t){let i=e.clientY,o=e.clientX,s=i-t.originalOffsetY,n=o-t.originalOffsetX;i<topBar.offsetHeight?this.createWindowSizeProjection(t,"maximum"):o<30?this.createWindowSizeProjection(t,"left-half"):o>document.body.offsetWidth-30?this.createWindowSizeProjection(t,"right-half"):this.hideWindowSizeProjection(t),s=s<topBar.offsetHeight?topBar.offsetHeight:s,t.getProcessElement().style.top=s+"px",t.getProcessElement().style.left=n+"px"},makeProcessResizable:function(e){const t=document.querySelector(e),i=document.querySelectorAll(e+" resize_point"),o=t.style.minWidth.replace("px","")||150,s=t.style.minHeight.replace("px","")||150;let n=0,r=0,l=0,d=0,p=0,c=0;i.forEach(e=>{function i(i){const a=e.classList.toString();let h=0,m=0;a.includes("top")?(h=r-(i.pageY-c),h>s&&h<=window.innerHeight&&(t.style.height=h+"px",t.style.top=d+(i.pageY-c)+"px")):a.includes("bottom")&&(h=r+(i.pageY-c),h>s&&h<=window.innerHeight&&(t.style.height=h+"px")),a.includes("left")?(m=n-(i.pageX-p),m>o&&m<=window.innerWidth&&(t.style.width=m+"px",t.style.left=l+(i.pageX-p)+"px")):a.includes("right")&&(m=n+(i.pageX-p),m>o&&m<=window.innerWidth&&(t.style.width=m+"px")),h>=window.innerHeight&&(t.style.height=window.innerHeight),m>=window.innerWidth&&(t.style.width=window.innerWidth)}function a(){document.body.setAttribute("onmousemove",null),window.removeEventListener("mousemove",i)}e.addEventListener("mousedown",(function(e){e.preventDefault(),n=parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),r=parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px","")),l=t.getBoundingClientRect().left,d=t.getBoundingClientRect().top,p=e.pageX,c=e.pageY,window.addEventListener("mousemove",i),window.addEventListener("mouseup",a)}))})}};